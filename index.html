<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <script src="/tooltip.js"></script>
    <script src="/usMap.js"></script>
    <link rel="stylesheet" href="/styles.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,700&display=swap');

        body {
            font-family: 'Lato', arial;
            font-size: 14px;
            font-weight: 400;
        }

        #pick_county_input {
            font-family: 'Lato', arial;
            font-size: 16px;
            font-weight: 300;
        }

        #pick_state_input {
            font-family: 'Lato', arial;
            font-size: 16px;
            font-weight: 300;
        }

        #reset_button {
            font-family: 'Lato', arial;
            font-size: 16px;
            font-weight: 300;
        }

        label {
            font-size: 16px;
            font-weight: 300;
        }

        h2 {
            font-weight: 300;
        }

        #viz2 {
            visibility: hidden;
        }

        .state {
            fill: #ddd;
        }

        /* .selected_counties {
    fill: #ddd;
} */

        .outline {
            stroke: #fff;
            stroke-width: 1px;
            fill: none;
        }

        .visualization_1 {
            display: flex;
        }

        .viz_1_map {
            flex: 1;
        }

        .mouseover_outline {
            stroke: black;
            stroke-width: 1px;
            fill: none;
        }
    </style>
</head>

<body>
    <h1>Employment in the United States</h1>

    <h2>Part I: How well-employed is your county?</h2>
    <h3>Select your county below to find out how employment rates in your county compare to other counties in the U.S.
    </h3>
    <div id="user_state_county_inputs">
        <label for="pick_state_input">Home State: </label>
        <select name="pick_state_input" id="pick_state_input">
            <option value="" disabled selected>Select your state</option>
        </select>

        <label for="pick_county_input">Home County: </label>
        <select name="pick_county_input" id="pick_county_input">
            <option value="" selected>Select your county</option>
        </select>

        <!-- <button type="button" id="reset_button">Reset</button> -->
    </div>
    <br>

    <div class="visualization_1">
        <div class="viz_1_map element_1">
            <svg id="state_min" height="200" width="300"></svg>
        </div>
        <div class="viz_1_map element_2">
            <svg id="user_state" height="400" width="600"></svg>
        </div>
        <div class="viz_1_map element_3">
            <svg id="state_max" height="200" width="300"></svg>
        </div>
    </div>

    <h1 id="viz2">Discover Other Counties</h1>
    <div id="us_div" style="width: 70%; float: left;">
        <svg id="us_map" height="800" style="width: 85%; padding-left: 10%;" />
    </div>
    <div id="filters" style="height:600px; width: 20%; float:left; padding-left: 5%; padding-right: 5%;"></div>

    <div id="v3">
        <svg id="v3_c1" height="400" width="600"></svg>
        <svg id="v3_c2" height="400" width="600"></svg>
    </div>
    <div class="miniGraphs">
        <svg id="hs_graph" height="500" width="800"></svg>
        <svg id="employment_graph" height="500" width="800"></svg>
    </div>

    <div id="Filtering">

        <p>Filter by Literacy</p>
        <button type="button" id="literacy_button0">Minimum value</button>
        <button type="button" id="literacy_button1">25th percentile</button>
        <button type="button" id="literacy_button2">50th percentile</button>
        <button type="button" id="literacy_button3">75th percentile</button>
        <button type="button" id="literacy_button4">Maximum value</button>
    </div>
    <div id="all_svgs">
        <div class="visualization_1">
            <div class="viz_1_map element_1">
                <svg id="state_min" height="300" width="300"></svg>
            </div>
            <div class="viz_1_map element_2">
                <svg id="user_state" height="500" width="500"></svg>
            </div>
            <div class="viz_1_map element_3">
                <svg id="state_max" height="300" width="300"></svg>
            </div>
        </div>
        <!-- margin-top:30px -->
        <div class="colorLegend_elm1" style="text-align: center;">
            <svg id="colorLegend" height="50" width="500" style="background: #fff; margin-top: 10px; font-family: 'Lato', arial;
                font-size: 16px; font-weight: 300;"></svg>
        </div>
        <svg id="us_map" height="600" width="1000"></svg>
        <!-- <svg id="chart2b" height="500" width="800"></svg>
        <svg id="chart2c" height="200" width="300"></svg>
        <svg id="chart2d" height="200" width="300"></svg> -->
        <div id="v3">
            <svg id="v3_c1" height="400" width="600"></svg>
            <svg id="v3_c2" height="400" width="600"></svg>
        </div>
        <div class="miniGraphs">
            <svg id="hs_graph" height="300" width="500"></svg>
            <svg id="employment_graph" height="300" width="500"></svg>
            <svg id="gender_graph" height="400" width="400">
            </svg>
        </div>
    </div>

    <script>
        // PART 1: COUNTY VISUALIZATION (SHRUTI)
        const us_svg = d3.select("#us_map");

        const request_data = async function () {
            //load us map json
            const us = await d3.json("counties-10m.json");

            var us_projection = d3.geoAlbersUsa().scale(1500).translate([575, 400]);
            var us_path = d3.geoPath().projection(us_projection);

            var nation = topojson.feature(us, us.objects.nation);
            var states = topojson.feature(us, us.objects.states)
            var counties = topojson.feature(us, us.objects.counties);

            var statesMesh = topojson.mesh(us, us.objects.states);
            var countiesMesh = topojson.mesh(us, us.objects.counties);

            // import datasets and populate new json
            var zip_codes = await d3.csv("fipscode_zipcode.csv", d3.autoType);
            var employment = await d3.csv("employment_data.csv", d3.autoType);
            var education = await d3.csv("education.csv", d3.autoType);
            var income = await d3.csv("unemployment_income.csv", d3.autoType);

            data = {}
            nameToFIPS = {}

            counties.features.forEach((county, i) => {
                data[Number(county.id)] = {};
            })

            employment.forEach((d, i) => {
                const id = d['FIPS_code'].toString()
                data[id]["employment_rate"] = d['Employed'];
                data[id]["state"] = d['State'].trim();
                data[id]["county_name"] = d['County'];
                data[id]["literacy"] = d["Lit_P3"];
                data[id]["OCC_Manage"] = 100 * d["OCC_Manage"];
                data[id]["OCC_Service"] = 100 * d["OCC_Service"];
                data[id]["OCC_Sales"] = 100 * d["OCC_Sales"];
                data[id]["OCC_Military"] = 100 * d["OCC_Military"];
                data[id]["OCC_Prod"] = 100 * d["OCC_Prod"];
                data[id]["Male"] = 100 * d["Male"];
                data[id]["Female"] = 100 * d["Female"];

            });

            education.forEach((d, i) => {
                const id = d['FIPS Code'];
                if (id in data) {
                    data[id]["high_school"] = d['Percent of adults with a high school diploma only, 2015-19'] + d["Percent of adults completing some college or associate's degree, 2015-19"] + d["Percent of adults with a bachelor's degree or higher, 2015-19"];
                    data[id]["college"] = d["Percent of adults with a bachelor's degree or higher, 2015-19"];
                    data[id]["Percent of adults with less than a high school diploma, 2015-19"] = d["Percent of adults with less than a high school diploma, 2015-19"];
                    data[id]["Percent of adults with a high school diploma only, 2015-19"] = d["Percent of adults with a high school diploma only, 2015-19"];
                    data[id]["Percent of adults with a bachelor's degree or higher, 2015-19"] = d["Percent of adults with a high school diploma only, 2015-19"];
                    data[id]["state_abbreviation"] = d['State'];
                }
            });

            income.forEach((d, i) => {
                const id = d['fips_txt']
                if (id in data && ["Attribute" === "Median_Household_Income_2019"]) {
                    data[id]["income"] = d["Value"]
                }
            });

            // color scale constants
            var all_employment_values = [];
            employment.forEach((d, i) => {
                all_employment_values.push(d['Employed'])
            });

            const colorsArray = ["#B5375D", "#DBADA6", "#DEDEDE", "#A1D5ED", "#26C7CB"];

            // array of all states to dropdown
            var all_states = [];
            states.features.forEach((state, i) => {
                state_name = state.properties.name;
                all_states.push(state_name);
            });
            all_states.sort();

            // add all states to select button
            d3.select("#pick_state_input")
                .selectAll('state_options')
                .data(all_states)
                .enter()
                .append('option')
                .text(d => { return d; })
                .attr("value", d => { return d; })

            // update county dropdown based on state selection
            //d3.select("#pick_state_input").on("change", function (d) {
            //var selected_state_input = d3.select(this).property("value");
            var selected_state_input = "New York";
            update_county_dropdown(selected_state_input);
            //});


            function update_county_dropdown(user_state_input) {
                var user_counties = [];
                Object.keys(data).forEach((county) => {
                    if (data[county]['state'] === user_state_input) {
                        user_counties.push(data[county]['county_name']);
                    };
                    user_counties.sort();
                });

                d3.selectAll('.county_options')
                    .remove();

                d3.select("#pick_county_input")
                    .selectAll('county_options')
                    .data(user_counties)
                    .enter()
                    .append('option').attr("class", 'county_options')
                    .text(d => { return d; })
                    .attr("value", d => { return d; })

                //d3.select("#pick_county_input").on("change", function (d) {
                //var selected_county_input = d3.select(this).property("value");
                var selected_county_input = "Dutchess County";
                user_county_id_input = find_county_id(selected_state_input, selected_county_input);
                make_state_map(user_county_id_input, "#user_state");

                //VISUALIZATION 2: US MAP + FILTERS
                drawUS(counties, us_path, statesMesh, Object.keys(data));

                const sliderWidth = 400
                const sliderHeight = 20
                makeSlider(d3.select("#filters"), "Employment Rate", "employment_rate", sliderHeight, sliderWidth, counties, us_path, statesMesh, selected_county_input, data)
                makeSlider(d3.select("#filters"), "Median Household Income", "income", sliderHeight, sliderWidth, counties, us_path, statesMesh, selected_county_input, data)
                makeSlider(d3.select("#filters"), "Adult Literacy", "literacy", sliderHeight, sliderWidth, counties, us_path, statesMesh, selected_county_input, data)
                makeSlider(d3.select("#filters"), "Completed High School", "high_school", sliderHeight, sliderWidth, counties, us_path, statesMesh, selected_county_input, data)
                makeSlider(d3.select("#filters"), "Completed College", "college", sliderHeight, sliderWidth, counties, us_path, statesMesh, selected_county_input, data)

                d3.select("#viz2").style("visibility", "visible");
                //});
            };

            function find_county_id(state, county) {
                selected_county_id = "";
                employment.forEach((d, i) => {
                    if (d['State'].trim() === state && d['County'] === county) {
                        selected_county_id = d['FIPS_code'];
                    };
                });
                return selected_county_id;
            };

            function make_state_map(county_id, svg_id) {
                var state_projection = d3.geoAlbersUsa().scale(1).translate([0, 0]);
                var state_path = d3.geoPath().projection(state_projection);

                const state_svg = d3.select(svg_id);
                const state_width = state_svg.attr("width");
                const state_height = state_svg.attr("height");

                user_input_county_id_string = county_id.toString();

                if (user_input_county_id_string.length === 4) {
                    user_input_state_id = "0" + user_input_county_id_string.substring(0, 1);
                }
                else {
                    user_input_state_id = user_input_county_id_string.substring(0, 2);
                }

                selected_state = states.features.filter(function (d) {
                    return d.id === user_input_state_id;
                });

                selected_counties = counties.features.filter(function (d) {
                    return d.id.substring(0, 2) === user_input_state_id;
                });

                //source for centering state map: https://bl.ocks.org/gregdevs/a73f8a16f129757c037e72ecdebdd8f2
                var state_bounds = state_path.bounds(selected_state[0]);
                var state_x_difference = state_bounds[1][0] - state_bounds[0][0];
                var state_y_difference = state_bounds[1][1] - state_bounds[0][1];
                var state_x_sum = state_bounds[1][0] + state_bounds[0][0];
                var state_y_sum = state_bounds[1][1] + state_bounds[0][1];

                var state_scale = 0.95 / Math.max(state_x_difference / state_width, state_y_difference / state_height);
                var state_translate = [(state_width - state_scale * state_x_sum) / 2, (state_height - state_scale * state_y_sum) / 2];

                state_projection.scale(state_scale)
                    .translate(state_translate);

                const colorScale = d3.scaleQuantile()
                    .domain(all_employment_values)
                    .range(colorsArray);

                drawLegend("#colorLegend", colorScale);

                // outline for selected state
                let momesh = state_svg.append("path")
                    .attr("class", "mouseover_outline")
                    .attr("d", "");

                var mo = topojson.mesh(us, us.objects.counties, function (a, b) { return a.id === county_id || b.id === county_id; });
                momesh.datum(mo).attr("d", state_path)

                state_svg.selectAll("path.selected_counties")
                    .remove();

                //draw state map
                state_svg.selectAll("path.selected_counties").data(selected_counties)
                    .join("path")
                    .attr("class", "selected_counties")
                    .attr("d", state_path)
                    .attr("fill", d => colorScale(Number(data[Number(d.id)]["employment_rate"])));

                state_svg.append("path").datum(countiesMesh)
                    .attr("class", "outline")
                    .attr("d", state_path);

                add_tooltip(svg_id, state_path)
            };
            // add state label
            console.log(data[county_id]["state_abbreviation"]);

            state_svg.selectAll("text")
                .remove();

            state_svg.append("text")
                .attr("x", state_width / 2)
                .attr("y", 20)
                .attr("text-anchor", "middle")
                .style("font-weight", 600)
                .style("font-size", "16px")
                .style("margin-bottom", "10px")
                .text(data[county_id]["county_name"] + ", " + data[county_id]["state_abbreviation"]);

            add_tooltip("#v3_c1", us, state_path, counties)
        };

        // reset button for dropdowns
        // d3.select("#reset_button").on("click", function (d) {
        //     console.log("in reset");
        //     d3.select("#pick_state_input")
        //         .selectAll('state_options')
        //         .exit()
        //         .remove();

        //     d3.select("#pick_county_input")
        //         .selectAll('county_options')
        //         .exit()
        //         .remove();
        // });

        make_state_map(41025, "#state_min");
        make_state_map(46117, "#state_max");

        function drawLegend(legend_id, legendColorScale) {

            // Bonus code here to draw an adaptive gradient legend so we can see different color scales for choropleth maps
            //  Credit Prof. Rz if you are basing a legend on this structure, and note SERIOUS PERFORMANCE CONSIDERATIONS
            // Source: Professor. Rz, INFO 3300 Spring 2021 Cornell University, Lecture 03/22
            const legend = d3.select(legend_id);
            const legendWidth = legend.attr("width");
            const legendHeight = legend.attr("height");
            const legendMinMax = d3.extent(legendColorScale.domain()); // way to recover the minMax from most kinds of scales
            const barHeight = 20;
            const stepSize = 4; // warning, not using a canvas element so lots of rect tags will be created for low stepSize, causing issues with performance
            // Extend the minmax by 1 in either direction to expose more features
            const pixelScale = d3.scaleLinear().domain([0, legendWidth - 40]).range([legendMinMax[0], legendMinMax[1]]); // In this case the "data" are pixels, and we get numbers to use in colorScale
            const barScale = d3.scaleLinear().domain([legendMinMax[0], legendMinMax[1]]).range([0, legendWidth - 40]);
            const barAxis = d3.axisBottom(barScale);
            // Check if we're using a quantile scale - if so, we can do better
            if (legendColorScale.hasOwnProperty('quantiles')) {
                // Use the quantile breakpoints plus the min and max of the scale as tick values
                barAxis.tickValues(legendColorScale.quantiles().concat(legendMinMax));
            }
            legend.append("g")
                .attr("class", "colorbar axis")
                .attr("transform", "translate(" + (20) + "," + (barHeight + 5) + ")")
                .call(barAxis);
            // Draw rects of color down the bar
            let bar = legend.append("g").attr("transform", "translate(" + (20) + "," + (0) + ")")
            for (let i = 0; i < legendWidth - 40; i = i + stepSize) {
                bar.append("rect")
                    .attr("x", i)
                    .attr("y", 0)
                    .attr("width", stepSize)
                    .attr("height", barHeight)
                    .style("fill", legendColorScale(pixelScale(i))); // pixels => countData => color
            }
            // Put lines in to mark actual min and max of our data
            bar.append("line").attr("stroke", "white").attr("stroke-width", 3).attr("x1", barScale(legendMinMax[0])).attr("x2", barScale(legendMinMax[0])).attr("y1", 0).attr("y1", barHeight + 4);
            bar.append("line").attr("stroke", "white").attr("stroke-width", 3).attr("x1", barScale(legendMinMax[1])).attr("x2", barScale(legendMinMax[1])).attr("y1", 0).attr("y1", barHeight + 4);
        };

        const colorScale = d3.scaleQuantile()
            .domain(all_employment_values)
            .range(colorsArray);

        //draw us map
        us_svg.selectAll("path.counties").data(counties.features)
            .join("path")
            .attr("class", "counties")
            .attr("d", us_path)
            .attr("fill", d => colorScale(Number(data[Number(d.id)]["employment_rate"])));

        us_svg.append("path").datum(statesMesh)
            .attr("class", "outline")
            .attr("d", us_path);

        // PART 2: US MAP WITH COUNTIES WITH UNEMPLOYMENT RATE (Rachel)

        console.log(counties);


        // var filters = {};
        // var match = topojson.feature(us, us.objects.counties);

        // function matchCounties(matches) {
        // console.log("matching", matches)
        // console.log(filters)
        // matches = matches.filter(pointPassesFilters)
        // // data.forEach( d => { d.position = projection([d.Longitude, d.Latitude]);});
        // console.log(matches)
        // }

        // function makeSlider(container, label, attribute, sliderWidth, sliderHeight) {

        // let values = employment.map(d => d[attribute] * 100);

        // let minMax = d3.extent(values);
        // let xScale = d3.scaleLinear().domain(minMax).range([10, sliderWidth - 10]); // padding here for ease
        // let xAxis = d3.axisBottom(xScale).tickFormat(d3.format(".2"));

        // let wrapper = container.append("div").attr("class", "control");
        // wrapper.append("div").text(label);
        // let canvas = wrapper.append("svg").attr("width", sliderWidth)
        // .attr("height", sliderHeight + 20)
        // .attr("attribute", attribute);
        // let areaLayer = canvas.append("g");
        // canvas.append("g").attr("transform", `translate(0,${sliderHeight})`)
        // .call(xAxis);

        // let numBins = 10;
        // let histoGen = d3.histogram().domain(minMax)
        // .thresholds(numBins);
        // let counts = histoGen(values);

        // // To make the line chart smoother, we add a dummy value at the start of the array using unshift
        // counts.unshift({
        // x0: 0,
        // x1: counts[0].x0,
        // length: counts[0].length
        // });

        // let yScale = d3.scaleLinear().domain(d3.extent(counts, d => d.length))
        // .range([sliderHeight, 4]);

        // let area = d3.area().x(d => xScale(d.x1))
        // .y0(yScale(0))
        // .y1(d => yScale(d.length))
        // .curve(d3.curveNatural);
        // areaLayer.append("path").datum(counts)
        // .attr("class", "area")
        // .attr("d", area);

        // let filterFunc = d => true;
        // filters[attribute] = filterFunc;

        // // Allow the user to select regions of the slider
        // var brush = d3.brushX().extent([[10, 0],
        // [sliderWidth - 10, sliderHeight]])
        // .on("brush end", brushMoved);

        // function brushMoved(event) {
        // console.log(d3.event.type, d3.event.selection);
        // // Everything but clicking on brush area
        // if (event.selection !== null) {
        // let start = xScale.invert(event.selection[0]);
        // let end = xScale.invert(event.selection[1]);
        // let filterFunc = d => d[attribute] >= start && d[attribute] <= end; // filters[attribute]=filterFunc; //
        // matchCounties(match) // } // // Clicking on brush area to empty it out // else { // let filterFunc=d=> true;
        // filters[attribute] = filterFunc;
        // matchCounties(match)
        // }
        // }
        // canvas.append("g").attr("class", "brush").call(brush);
        // }

        // makeSlider(d3.select("#multiple"), "Employment Rate", "Employed", 500, 20)
        // makeSlider(d3.select("#multiple"), "Unemployment Rate", "Unemployed", 500, 20)
        // makeSlider(d3.select("#multiple"), "Poverty", "Poverty_100", 500, 20)

        //PART 3: COMPARE COUNTIES (CRYSTAL)
        var compare1 = 2016
        var compare2 = 36081
        make_state_map(compare1, "#v3_c1");
        make_state_map(compare2, "#v3_c2");


        // HS EDUCATION MINI GRAPH
        const svg = d3.select("svg#hs_graph");
        const width = svg.attr("width");
        const height = svg.attr("height");
        const margin = { "top": 40, "right": 10, "bottom": 50, "left": 60 };
        const chartWidth = width - margin.left - margin.right;
        const chartHeight = height - margin.top - margin.bottom


        let annotations = svg.append("g").attr("id", "annotations");
        let chartArea = svg.append("g").attr("id", "points")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        const hsScale = d3.scaleLinear().domain([0, 100]).range([chartHeight, 0])
        let leftAxis = d3.axisLeft(hsScale).tickFormat(d3.format(''));
        let leftGridlines = d3.axisLeft(hsScale)
            .tickSize(-chartWidth - 10)
            .tickFormat("")

        annotations.append("g")
            .attr("class", "y axis")
            .style("font", "11px Montserrat")
            .attr("transform", `translate(${margin.left - 10},${margin.top})`)
            .call(leftAxis)
        annotations.append("g")
            .attr("class", "y gridlines")
            .attr("transform", `translate(${margin.left - 10},${margin.top})`)
            .call(leftGridlines);

        const xaxisScale = d3.scalePoint()
            .domain(["less than HS education", "only HS education", "more than HS education"])
            .range([20, chartWidth - 70]);

        const xaxisScale2 = d3.scalePoint()
            .domain(["less than HS education", "only HS education", "more than HS education"])
            .range([50, chartWidth - 40]);

        let bottomAxis = d3.axisBottom(xaxisScale)
        let bottomAxisG = annotations.append("g")
            .style("font", "14px Montserrat")
            .attr("class", "x axis")
            .attr("transform", `translate(${margin.left},${chartHeight + margin.top + 10})`)
            .call(bottomAxis);

        //chart title
        svg.append("text")
            .attr("x", width / 2)
            .attr("y", 20)
            .style("text-anchor", "middle")
            .style("font-weight", 600)
            .style("font-size", "16px")
            .text("Education Graph");

        svg.append("text")
            .attr("x", width - 50)
            .attr("y", 10)
            .style("text-anchor", "middle")
            .style("font-weight", 200)
            .style("stroke", "blue")
            .text("County 1");

        svg.append("text")
            .attr("x", width - 50)
            .attr("y", 30)
            .style("text-anchor", "middle")
            .style("font-weight", 200)
            .style("stroke", "red")
            .text("County 2");

        //x axis labels
        svg.append("text")
            .attr("x", width / 2)
            .attr("y", height)
            .style("text-anchor", "middle")
            .style("font-weight", 600);

        //y axis label
        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 0)
            .attr("x", 0 - (height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .style("font-weight", 600)
            .text("Percentage");

        //rectangle for less than HS education
        chartArea.append("line")
            .attr("x1", xaxisScale("less than HS education"))
            .attr("x2", xaxisScale("less than HS education"))
            .attr("y1", chartHeight)
            .attr("y2", hsScale(data[compare1]["Percent of adults with less than a high school diploma, 2015-19"]))
            .style("stroke", "blue")
            .style("stroke-width", 30);

        chartArea.append("line")
            .attr("x1", xaxisScale2("less than HS education"))
            .attr("x2", xaxisScale2("less than HS education"))
            .attr("y1", chartHeight)
            .attr("y2", hsScale(data[compare2]["Percent of adults with less than a high school diploma, 2015-19"]))
            .style("stroke", "red")
            .style("stroke-width", 30);

        //rectangle for only HS education
        chartArea.append("line")
            .attr("x1", xaxisScale("only HS education"))
            .attr("x2", xaxisScale("only HS education"))
            .attr("y1", chartHeight)
            .attr("y2", hsScale(data[compare1]["Percent of adults with a high school diploma only, 2015-19"]))
            .style("stroke", "blue")
            .style("stroke-width", 30);

        chartArea.append("line")
            .attr("x1", xaxisScale2("only HS education"))
            .attr("x2", xaxisScale2("only HS education"))
            .attr("y1", chartHeight)
            .attr("y2", hsScale(data[compare2]["Percent of adults with a high school diploma only, 2015-19"]))
            .style("stroke", "red")
            .style("stroke-width", 30);

        //rectangle for more than HS education
        chartArea.append("line")
            .attr("x1", xaxisScale("more than HS education"))
            .attr("x2", xaxisScale("more than HS education"))
            .attr("y1", chartHeight)
            .attr("y2", hsScale(data[compare1]["Percent of adults with a bachelor's degree or higher, 2015-19"]))
            .style("stroke", "blue")
            .style("stroke-width", 30);

        chartArea.append("line")
            .attr("x1", xaxisScale2("more than HS education"))
            .attr("x2", xaxisScale2("more than HS education"))
            .attr("y1", chartHeight)
            .attr("y2", hsScale(data[compare2]["Percent of adults with a bachelor's degree or higher, 2015-19"]))
            .style("stroke", "red")
            .style("stroke-width", 30);




        // EMPLOYMENT SECTOR BAR CHART MINI GRAPH
        const svg2 = d3.select("svg#employment_graph");
        const width2 = svg2.attr("width");
        const height2 = svg2.attr("height");
        const margin2 = { "top": 40, "right": 10, "bottom": 50, "left": 60 };
        const chartWidth2 = width2 - margin2.left - margin2.right;
        const chartHeight2 = height2 - margin2.top - margin2.bottom


        let annotations2 = svg2.append("g").attr("id", "annotations");
        let chartArea2 = svg2.append("g").attr("id", "points")
            .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");

        const employmentScale = d3.scaleLinear().domain([0, 100]).range([chartHeight2, 0])
        let leftAxis2 = d3.axisLeft(employmentScale).tickFormat(d3.format(''));
        let leftGridlines2 = d3.axisLeft(employmentScale)
            .tickSize(-chartWidth2 - 10)
            .tickFormat("")

        annotations2.append("g")
            .attr("class", "y axis")
            .style("font", "11px Montserrat")
            .attr("transform", `translate(${margin2.left - 10},${margin2.top})`)
            .call(leftAxis2)
        annotations2.append("g")
            .attr("class", "y gridlines")
            .attr("transform", `translate(${margin2.left - 10},${margin2.top})`)
            .call(leftGridlines2);

        const xaxisScale_employment = d3.scalePoint()
            .domain(["Management", "Service", "Sales", "Military", "Production"])
            .range([20, chartWidth2 - 70]);
        const xaxisScale_employment2 = d3.scalePoint()
            .domain(["Management", "Service", "Sales", "Military", "Production"])
            .range([50, chartWidth2 - 40]);

        let bottomAxis2 = d3.axisBottom(xaxisScale_employment)
        let bottomAxisG2 = annotations2.append("g")
            .style("font", "14px Montserrat")
            .attr("class", "x axis")
            .attr("transform", `translate(${margin2.left},${chartHeight2 + margin2.top + 10})`)
            .call(bottomAxis2);

        //chart title
        svg2.append("text")
            .attr("x", width2 / 2)
            .attr("y", 20)
            .style("text-anchor", "middle")
            .style("font-weight", 600)
            .style("font-size", "16px")
            .text("Employment Graph");


        svg2.append("text")
            .attr("x", width2 - 50)
            .attr("y", 10)
            .style("text-anchor", "middle")
            .style("font-weight", 200)
            .style("stroke", "blue")
            .text("County 1");

        svg2.append("text")
            .attr("x", width2 - 50)
            .attr("y", 30)
            .style("text-anchor", "middle")
            .style("font-weight", 200)
            .style("stroke", "red")
            .text("County 2");

        //x axis labels
        svg2.append("text")
            .attr("x", width2 / 2)
            .attr("y", height2)
            .style("text-anchor", "middle")
            .style("font-weight", 600);

        //y axis label
        svg2.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 0)
            .attr("x", 0 - (height2 / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .style("font-weight", 600)
            .text("Percentage");

        //rectangle for Management
        chartArea2.append("line")
            .attr("x1", xaxisScale_employment("Management"))
            .attr("x2", xaxisScale_employment("Management"))
            .attr("y1", chartHeight2)
            .attr("y2", employmentScale(data[compare1]["OCC_Manage"]))
            .style("stroke", "blue")
            .style("stroke-width", 30);

        chartArea2.append("line")
            .attr("x1", xaxisScale_employment2("Management"))
            .attr("x2", xaxisScale_employment2("Management"))
            .attr("y1", chartHeight2)
            .attr("y2", employmentScale(data[compare2]["OCC_Manage"]))
            .style("stroke", "red")
            .style("stroke-width", 30);

        //rectangle for Service
        chartArea2.append("line")
            .attr("x1", xaxisScale_employment("Service"))
            .attr("x2", xaxisScale_employment("Service"))
            .attr("y1", chartHeight2)
            .attr("y2", employmentScale(data[compare1]["OCC_Service"]))
            .style("stroke", "blue")
            .style("stroke-width", 30);

        chartArea2.append("line")
            .attr("x1", xaxisScale_employment2("Service"))
            .attr("x2", xaxisScale_employment2("Service"))
            .attr("y1", chartHeight2)
            .attr("y2", employmentScale(data[compare2]["OCC_Service"]))
            .style("stroke", "red")
            .style("stroke-width", 30);

        //rectangle for Sales
        chartArea2.append("line")
            .attr("x1", xaxisScale_employment("Sales"))
            .attr("x2", xaxisScale_employment("Sales"))
            .attr("y1", chartHeight2)
            .attr("y2", employmentScale(data[compare1]["OCC_Sales"]))
            .style("stroke", "blue")
            .style("stroke-width", 30);

        chartArea2.append("line")
            .attr("x1", xaxisScale_employment2("Sales"))
            .attr("x2", xaxisScale_employment2("Sales"))
            .attr("y1", chartHeight2)
            .attr("y2", employmentScale(data[compare2]["OCC_Sales"]))
            .style("stroke", "red")
            .style("stroke-width", 30);

        //rectangle for Military
        chartArea2.append("line")
            .attr("x1", xaxisScale_employment("Military"))
            .attr("x2", xaxisScale_employment("Military"))
            .attr("y1", chartHeight2)
            .attr("y2", employmentScale(data[compare1]["OCC_Military"]))
            .style("stroke", "blue")
            .style("stroke-width", 30);

        chartArea2.append("line")
            .attr("x1", xaxisScale_employment2("Military"))
            .attr("x2", xaxisScale_employment2("Military"))
            .attr("y1", chartHeight2)
            .attr("y2", employmentScale(data[compare2]["OCC_Military"]))
            .style("stroke", "red")
            .style("stroke-width", 30);

        //rectangle for Production
        chartArea2.append("line")
            .attr("x1", xaxisScale_employment("Production"))
            .attr("x2", xaxisScale_employment("Production"))
            .attr("y1", chartHeight2)
            .attr("y2", employmentScale(data[compare1]["OCC_Prod"]))
            .style("stroke", "blue")
            .style("stroke-width", 30);

        chartArea2.append("line")
            .attr("x1", xaxisScale_employment2("Production"))
            .attr("x2", xaxisScale_employment2("Production"))
            .attr("y1", chartHeight2)
            .attr("y2", employmentScale(data[compare2]["OCC_Prod"]))
            .style("stroke", "red")
            .style("stroke-width", 30);




        // GENDER RATIO PIE CHART CHART MINI GRAPH
        const svg3 = d3.select("svg#gender_graph");

        //chart title
        svg3.append("text")
            .attr("x", width2 / 2)
            .attr("y", 20)
            .style("text-anchor", "middle")
            .style("font-weight", 600)
            .style("font-size", "16px")
            .text("Gender Graph");

        const data1 = {
            datasets: [{
                label: 'Gender Graph',
                data: [20, 80],
                backgroundColor: [
                    'blue',
                    'red'
                ],
                hoverOffset: 4
            }]
        };

        const config = {
            type: 'pie',
            data: data1,
        };

        //};
        request_data();

    </script>

</body>

</html>